---
const { tag } = Astro.params;

import { compareAsc } from "date-fns";
import { getCollection } from "astro:content";
import HomePage from "../../components/HomePage.astro";
import * as R from "ramda";
const { posts } = Astro.props;

export async function getStaticPaths() {
  const posts = (await getCollection("essays"))
    .sort((a, b) => -compareAsc(a.data.created, b.data.created))
    .filter((p) => !p.data.tags.includes("no-index"));
  const tags = R.uniq(posts.flatMap((p) => p.data.tags));
  return tags.map((tag) => {
    const filteredPosts = posts.filter((post) => post.data.tags.includes(tag));
    return {
      params: { tag },
      props: { posts: filteredPosts },
    };
  });
}
---

<HomePage posts={posts} activeTag={tag} />
